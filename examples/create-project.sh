#!/bin/bash

# Make sure environment variables are set (via .envrc or manually)
# Required: YAY_PARTNER_USERNAME, YAY_PARTNER_PASSWORD, YAY_PARTNER_USER_AGENT, YAY_PARTNER_BASE_URL

# Check required environment variables
if [ -z "${YAY_PARTNER_BASE_URL}" ]; then
  echo "‚ùå YAY_PARTNER_BASE_URL environment variable is not set"
  echo "Please make sure .envrc is loaded (run: direnv allow)"
  exit 1
fi

if [ -z "${YAY_PARTNER_USERNAME}" ]; then
  echo "‚ùå YAY_PARTNER_USERNAME environment variable is not set"
  exit 1
fi

if [ -z "${YAY_PARTNER_PASSWORD}" ]; then
  echo "‚ùå YAY_PARTNER_PASSWORD environment variable is not set"
  exit 1
fi

if [ -z "${YAY_PARTNER_USER_AGENT}" ]; then
  echo "‚ùå YAY_PARTNER_USER_AGENT environment variable is not set"
  exit 1
fi

echo "üìù Creating photobook project..."

response=$(curl -X POST "${YAY_PARTNER_BASE_URL}/papi/projects" \
  -u "${YAY_PARTNER_USERNAME}:${YAY_PARTNER_PASSWORD}" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "User-Agent: ${YAY_PARTNER_USER_AGENT}" \
  -w "\n%{http_code}" \
  -d '{
    "title": "Lara & Kens'\''s Wedding Album",
    "customer": {
      "firstname": "Lara",
      "lastname": "Croft",
      "email": "lara.croft@example.com",
      "address": {
        "line1": "Musterstra√üe 123",
        "line2": "Apartment 4B",
        "city": "Frankfurt",
        "postal_code": "10115",
        "country": "DE"
      }
    },
    "locale": "en_US",
    "upload": {
      "numberOfImages": 800,
      "coverUrl": "https://picsum.photos/1000/800.jpg",
      "photoUrls": [
        "https://picsum.photos/seed/wedding1/1000/800.jpg",
        "https://picsum.photos/seed/wedding2/1000/800.jpg",
        "https://picsum.photos/seed/wedding3/1000/800.jpg",
        "https://picsum.photos/seed/wedding4/1000/800.jpg",
        "https://picsum.photos/seed/wedding5/1000/800.jpg",
        "https://picsum.photos/seed/wedding6/1000/800.jpg",
        "https://picsum.photos/seed/wedding7/1000/800.jpg",
        "https://picsum.photos/seed/wedding8/1000/800.jpg",
        "https://picsum.photos/seed/wedding9/1000/800.jpg",
        "https://picsum.photos/seed/wedding10/1000/800.jpg",
        "https://picsum.photos/seed/wedding11/1000/800.jpg",
        "https://picsum.photos/seed/wedding12/1000/800.jpg",
        "https://picsum.photos/seed/wedding13/1000/800.jpg",
        "https://picsum.photos/seed/wedding14/1000/800.jpg",
        "https://picsum.photos/seed/wedding15/1000/800.jpg",
        "https://picsum.photos/seed/wedding16/1000/800.jpg",
        "https://picsum.photos/seed/wedding17/1000/800.jpg",
        "https://picsum.photos/seed/wedding18/1000/800.jpg",
        "https://picsum.photos/seed/wedding19/1000/800.jpg",
        "https://picsum.photos/seed/wedding20/1000/800.jpg",
        "https://picsum.photos/seed/wedding21/1000/800.jpg",
        "https://picsum.photos/seed/wedding22/1000/800.jpg",
        "https://picsum.photos/seed/wedding23/1000/800.jpg",
        "https://picsum.photos/seed/wedding24/1000/800.jpg",
        "https://picsum.photos/seed/wedding25/1000/800.jpg",
        "https://picsum.photos/seed/wedding26/1000/800.jpg",
        "https://picsum.photos/seed/wedding27/1000/800.jpg",
        "https://picsum.photos/seed/wedding28/1000/800.jpg",
        "https://picsum.photos/seed/wedding29/1000/800.jpg",
        "https://picsum.photos/seed/wedding30/1000/800.jpg",
        "https://picsum.photos/seed/wedding31/1000/800.jpg",
        "https://picsum.photos/seed/wedding32/1000/800.jpg",
        "https://picsum.photos/seed/wedding33/1000/800.jpg",
        "https://picsum.photos/seed/wedding34/1000/800.jpg",
        "https://picsum.photos/seed/wedding35/1000/800.jpg",
        "https://picsum.photos/seed/wedding36/1000/800.jpg",
        "https://picsum.photos/seed/wedding37/1000/800.jpg",
        "https://picsum.photos/seed/wedding38/1000/800.jpg",
        "https://picsum.photos/seed/wedding39/1000/800.jpg",
        "https://picsum.photos/seed/wedding40/1000/800.jpg",
        "https://picsum.photos/seed/wedding41/1000/800.jpg",
        "https://picsum.photos/seed/wedding42/1000/800.jpg",
        "https://picsum.photos/seed/wedding43/1000/800.jpg",
        "https://picsum.photos/seed/wedding44/1000/800.jpg",
        "https://picsum.photos/seed/wedding45/1000/800.jpg",
        "https://picsum.photos/seed/wedding46/1000/800.jpg",
        "https://picsum.photos/seed/wedding47/1000/800.jpg",
        "https://picsum.photos/seed/wedding48/1000/800.jpg",
        "https://picsum.photos/seed/wedding49/1000/800.jpg",
        "https://picsum.photos/seed/wedding50/1000/800.jpg",
        "https://picsum.photos/seed/wedding51/1000/800.jpg",
        "https://picsum.photos/seed/wedding52/1000/800.jpg",
        "https://picsum.photos/seed/wedding53/1000/800.jpg",
        "https://picsum.photos/seed/wedding54/1000/800.jpg",
        "https://picsum.photos/seed/wedding55/1000/800.jpg",
        "https://picsum.photos/seed/wedding56/1000/800.jpg",
        "https://picsum.photos/seed/wedding57/1000/800.jpg",
        "https://picsum.photos/seed/wedding58/1000/800.jpg",
        "https://picsum.photos/seed/wedding59/1000/800.jpg",
        "https://picsum.photos/seed/wedding60/1000/800.jpg",
        "https://picsum.photos/seed/wedding61/1000/800.jpg",
        "https://picsum.photos/seed/wedding62/1000/800.jpg",
        "https://picsum.photos/seed/wedding63/1000/800.jpg",
        "https://picsum.photos/seed/wedding64/1000/800.jpg",
        "https://picsum.photos/seed/wedding65/1000/800.jpg",
        "https://picsum.photos/seed/wedding66/1000/800.jpg",
        "https://picsum.photos/seed/wedding67/1000/800.jpg",
        "https://picsum.photos/seed/wedding68/1000/800.jpg",
        "https://picsum.photos/seed/wedding69/1000/800.jpg",
        "https://picsum.photos/seed/wedding70/1000/800.jpg",
        "https://picsum.photos/seed/wedding71/1000/800.jpg",
        "https://picsum.photos/seed/wedding72/1000/800.jpg",
        "https://picsum.photos/seed/wedding73/1000/800.jpg",
        "https://picsum.photos/seed/wedding74/1000/800.jpg",
        "https://picsum.photos/seed/wedding75/1000/800.jpg",
        "https://picsum.photos/seed/wedding76/1000/800.jpg",
        "https://picsum.photos/seed/wedding77/1000/800.jpg",
        "https://picsum.photos/seed/wedding78/1000/800.jpg",
        "https://picsum.photos/seed/wedding79/1000/800.jpg",
        "https://picsum.photos/seed/wedding80/1000/800.jpg",
        "https://picsum.photos/seed/wedding81/1000/800.jpg",
        "https://picsum.photos/seed/wedding82/1000/800.jpg",
        "https://picsum.photos/seed/wedding83/1000/800.jpg",
        "https://picsum.photos/seed/wedding84/1000/800.jpg",
        "https://picsum.photos/seed/wedding85/1000/800.jpg",
        "https://picsum.photos/seed/wedding86/1000/800.jpg",
        "https://picsum.photos/seed/wedding87/1000/800.jpg",
        "https://picsum.photos/seed/wedding88/1000/800.jpg",
        "https://picsum.photos/seed/wedding89/1000/800.jpg",
        "https://picsum.photos/seed/wedding90/1000/800.jpg",
        "https://picsum.photos/seed/wedding91/1000/800.jpg",
        "https://picsum.photos/seed/wedding92/1000/800.jpg",
        "https://picsum.photos/seed/wedding93/1000/800.jpg",
        "https://picsum.photos/seed/wedding94/1000/800.jpg",
        "https://picsum.photos/seed/wedding95/1000/800.jpg",
        "https://picsum.photos/seed/wedding96/1000/800.jpg",
        "https://picsum.photos/seed/wedding97/1000/800.jpg",
        "https://picsum.photos/seed/wedding98/1000/800.jpg",
        "https://picsum.photos/seed/wedding99/1000/800.jpg",
        "https://picsum.photos/seed/wedding100/1000/800.jpg",
        "https://picsum.photos/seed/wedding101/1000/800.jpg",
        "https://picsum.photos/seed/wedding102/1000/800.jpg",
        "https://picsum.photos/seed/wedding103/1000/800.jpg",
        "https://picsum.photos/seed/wedding104/1000/800.jpg",
        "https://picsum.photos/seed/wedding105/1000/800.jpg",
        "https://picsum.photos/seed/wedding106/1000/800.jpg",
        "https://picsum.photos/seed/wedding107/1000/800.jpg",
        "https://picsum.photos/seed/wedding108/1000/800.jpg",
        "https://picsum.photos/seed/wedding109/1000/800.jpg",
        "https://picsum.photos/seed/wedding110/1000/800.jpg",
        "https://picsum.photos/seed/wedding111/1000/800.jpg",
        "https://picsum.photos/seed/wedding112/1000/800.jpg",
        "https://picsum.photos/seed/wedding113/1000/800.jpg",
        "https://picsum.photos/seed/wedding114/1000/800.jpg",
        "https://picsum.photos/seed/wedding115/1000/800.jpg",
        "https://picsum.photos/seed/wedding116/1000/800.jpg",
        "https://picsum.photos/seed/wedding117/1000/800.jpg",
        "https://picsum.photos/seed/wedding118/1000/800.jpg",
        "https://picsum.photos/seed/wedding119/1000/800.jpg",
        "https://picsum.photos/seed/wedding120/1000/800.jpg",
        "https://picsum.photos/seed/wedding121/1000/800.jpg",
        "https://picsum.photos/seed/wedding122/1000/800.jpg",
        "https://picsum.photos/seed/wedding123/1000/800.jpg",
        "https://picsum.photos/seed/wedding124/1000/800.jpg",
        "https://picsum.photos/seed/wedding125/1000/800.jpg",
        "https://picsum.photos/seed/wedding126/1000/800.jpg",
        "https://picsum.photos/seed/wedding127/1000/800.jpg",
        "https://picsum.photos/seed/wedding128/1000/800.jpg",
        "https://picsum.photos/seed/wedding129/1000/800.jpg",
        "https://picsum.photos/seed/wedding130/1000/800.jpg",
        "https://picsum.photos/seed/wedding131/1000/800.jpg",
        "https://picsum.photos/seed/wedding132/1000/800.jpg",
        "https://picsum.photos/seed/wedding133/1000/800.jpg",
        "https://picsum.photos/seed/wedding134/1000/800.jpg",
        "https://picsum.photos/seed/wedding135/1000/800.jpg",
        "https://picsum.photos/seed/wedding136/1000/800.jpg",
        "https://picsum.photos/seed/wedding137/1000/800.jpg",
        "https://picsum.photos/seed/wedding138/1000/800.jpg",
        "https://picsum.photos/seed/wedding139/1000/800.jpg",
        "https://picsum.photos/seed/wedding140/1000/800.jpg",
        "https://picsum.photos/seed/wedding141/1000/800.jpg",
        "https://picsum.photos/seed/wedding142/1000/800.jpg",
        "https://picsum.photos/seed/wedding143/1000/800.jpg",
        "https://picsum.photos/seed/wedding144/1000/800.jpg",
        "https://picsum.photos/seed/wedding145/1000/800.jpg",
        "https://picsum.photos/seed/wedding146/1000/800.jpg",
        "https://picsum.photos/seed/wedding147/1000/800.jpg",
        "https://picsum.photos/seed/wedding148/1000/800.jpg",
        "https://picsum.photos/seed/wedding149/1000/800.jpg",
        "https://picsum.photos/seed/wedding150/1000/800.jpg",
        "https://picsum.photos/seed/wedding151/1000/800.jpg",
        "https://picsum.photos/seed/wedding152/1000/800.jpg",
        "https://picsum.photos/seed/wedding153/1000/800.jpg",
        "https://picsum.photos/seed/wedding154/1000/800.jpg",
        "https://picsum.photos/seed/wedding155/1000/800.jpg",
        "https://picsum.photos/seed/wedding156/1000/800.jpg",
        "https://picsum.photos/seed/wedding157/1000/800.jpg",
        "https://picsum.photos/seed/wedding158/1000/800.jpg",
        "https://picsum.photos/seed/wedding159/1000/800.jpg",
        "https://picsum.photos/seed/wedding160/1000/800.jpg",
        "https://picsum.photos/seed/wedding161/1000/800.jpg",
        "https://picsum.photos/seed/wedding162/1000/800.jpg",
        "https://picsum.photos/seed/wedding163/1000/800.jpg",
        "https://picsum.photos/seed/wedding164/1000/800.jpg",
        "https://picsum.photos/seed/wedding165/1000/800.jpg",
        "https://picsum.photos/seed/wedding166/1000/800.jpg",
        "https://picsum.photos/seed/wedding167/1000/800.jpg",
        "https://picsum.photos/seed/wedding168/1000/800.jpg",
        "https://picsum.photos/seed/wedding169/1000/800.jpg",
        "https://picsum.photos/seed/wedding170/1000/800.jpg",
        "https://picsum.photos/seed/wedding171/1000/800.jpg",
        "https://picsum.photos/seed/wedding172/1000/800.jpg",
        "https://picsum.photos/seed/wedding173/1000/800.jpg",
        "https://picsum.photos/seed/wedding174/1000/800.jpg",
        "https://picsum.photos/seed/wedding175/1000/800.jpg",
        "https://picsum.photos/seed/wedding176/1000/800.jpg",
        "https://picsum.photos/seed/wedding177/1000/800.jpg",
        "https://picsum.photos/seed/wedding178/1000/800.jpg",
        "https://picsum.photos/seed/wedding179/1000/800.jpg",
        "https://picsum.photos/seed/wedding180/1000/800.jpg",
        "https://picsum.photos/seed/wedding181/1000/800.jpg",
        "https://picsum.photos/seed/wedding182/1000/800.jpg",
        "https://picsum.photos/seed/wedding183/1000/800.jpg",
        "https://picsum.photos/seed/wedding184/1000/800.jpg",
        "https://picsum.photos/seed/wedding185/1000/800.jpg",
        "https://picsum.photos/seed/wedding186/1000/800.jpg",
        "https://picsum.photos/seed/wedding187/1000/800.jpg",
        "https://picsum.photos/seed/wedding188/1000/800.jpg",
        "https://picsum.photos/seed/wedding189/1000/800.jpg",
        "https://picsum.photos/seed/wedding190/1000/800.jpg",
        "https://picsum.photos/seed/wedding191/1000/800.jpg",
        "https://picsum.photos/seed/wedding192/1000/800.jpg",
        "https://picsum.photos/seed/wedding193/1000/800.jpg",
        "https://picsum.photos/seed/wedding194/1000/800.jpg",
        "https://picsum.photos/seed/wedding195/1000/800.jpg",
        "https://picsum.photos/seed/wedding196/1000/800.jpg",
        "https://picsum.photos/seed/wedding197/1000/800.jpg",
        "https://picsum.photos/seed/wedding198/1000/800.jpg",
        "https://picsum.photos/seed/wedding199/1000/800.jpg",
        "https://picsum.photos/seed/wedding200/1000/800.jpg",
        "https://picsum.photos/seed/wedding201/1000/800.jpg",
        "https://picsum.photos/seed/wedding202/1000/800.jpg",
        "https://picsum.photos/seed/wedding203/1000/800.jpg",
        "https://picsum.photos/seed/wedding204/1000/800.jpg",
        "https://picsum.photos/seed/wedding205/1000/800.jpg",
        "https://picsum.photos/seed/wedding206/1000/800.jpg",
        "https://picsum.photos/seed/wedding207/1000/800.jpg",
        "https://picsum.photos/seed/wedding208/1000/800.jpg",
        "https://picsum.photos/seed/wedding209/1000/800.jpg",
        "https://picsum.photos/seed/wedding210/1000/800.jpg",
        "https://picsum.photos/seed/wedding211/1000/800.jpg",
        "https://picsum.photos/seed/wedding212/1000/800.jpg",
        "https://picsum.photos/seed/wedding213/1000/800.jpg",
        "https://picsum.photos/seed/wedding214/1000/800.jpg",
        "https://picsum.photos/seed/wedding215/1000/800.jpg",
        "https://picsum.photos/seed/wedding216/1000/800.jpg",
        "https://picsum.photos/seed/wedding217/1000/800.jpg",
        "https://picsum.photos/seed/wedding218/1000/800.jpg",
        "https://picsum.photos/seed/wedding219/1000/800.jpg",
        "https://picsum.photos/seed/wedding220/1000/800.jpg",
        "https://picsum.photos/seed/wedding221/1000/800.jpg",
        "https://picsum.photos/seed/wedding222/1000/800.jpg",
        "https://picsum.photos/seed/wedding223/1000/800.jpg",
        "https://picsum.photos/seed/wedding224/1000/800.jpg",
        "https://picsum.photos/seed/wedding225/1000/800.jpg",
        "https://picsum.photos/seed/wedding226/1000/800.jpg",
        "https://picsum.photos/seed/wedding227/1000/800.jpg",
        "https://picsum.photos/seed/wedding228/1000/800.jpg",
        "https://picsum.photos/seed/wedding229/1000/800.jpg",
        "https://picsum.photos/seed/wedding230/1000/800.jpg",
        "https://picsum.photos/seed/wedding231/1000/800.jpg",
        "https://picsum.photos/seed/wedding232/1000/800.jpg",
        "https://picsum.photos/seed/wedding233/1000/800.jpg",
        "https://picsum.photos/seed/wedding234/1000/800.jpg",
        "https://picsum.photos/seed/wedding235/1000/800.jpg",
        "https://picsum.photos/seed/wedding236/1000/800.jpg",
        "https://picsum.photos/seed/wedding237/1000/800.jpg",
        "https://picsum.photos/seed/wedding238/1000/800.jpg",
        "https://picsum.photos/seed/wedding239/1000/800.jpg",
        "https://picsum.photos/seed/wedding240/1000/800.jpg",
        "https://picsum.photos/seed/wedding241/1000/800.jpg",
        "https://picsum.photos/seed/wedding242/1000/800.jpg",
        "https://picsum.photos/seed/wedding243/1000/800.jpg",
        "https://picsum.photos/seed/wedding244/1000/800.jpg",
        "https://picsum.photos/seed/wedding245/1000/800.jpg",
        "https://picsum.photos/seed/wedding246/1000/800.jpg",
        "https://picsum.photos/seed/wedding247/1000/800.jpg",
        "https://picsum.photos/seed/wedding248/1000/800.jpg",
        "https://picsum.photos/seed/wedding249/1000/800.jpg",
        "https://picsum.photos/seed/wedding250/1000/800.jpg",
        "https://picsum.photos/seed/wedding251/1000/800.jpg",
        "https://picsum.photos/seed/wedding252/1000/800.jpg",
        "https://picsum.photos/seed/wedding253/1000/800.jpg",
        "https://picsum.photos/seed/wedding254/1000/800.jpg",
        "https://picsum.photos/seed/wedding255/1000/800.jpg",
        "https://picsum.photos/seed/wedding256/1000/800.jpg",
        "https://picsum.photos/seed/wedding257/1000/800.jpg",
        "https://picsum.photos/seed/wedding258/1000/800.jpg",
        "https://picsum.photos/seed/wedding259/1000/800.jpg",
        "https://picsum.photos/seed/wedding260/1000/800.jpg",
        "https://picsum.photos/seed/wedding261/1000/800.jpg",
        "https://picsum.photos/seed/wedding262/1000/800.jpg",
        "https://picsum.photos/seed/wedding263/1000/800.jpg",
        "https://picsum.photos/seed/wedding264/1000/800.jpg",
        "https://picsum.photos/seed/wedding265/1000/800.jpg",
        "https://picsum.photos/seed/wedding266/1000/800.jpg",
        "https://picsum.photos/seed/wedding267/1000/800.jpg",
        "https://picsum.photos/seed/wedding268/1000/800.jpg",
        "https://picsum.photos/seed/wedding269/1000/800.jpg",
        "https://picsum.photos/seed/wedding270/1000/800.jpg",
        "https://picsum.photos/seed/wedding271/1000/800.jpg",
        "https://picsum.photos/seed/wedding272/1000/800.jpg",
        "https://picsum.photos/seed/wedding273/1000/800.jpg",
        "https://picsum.photos/seed/wedding274/1000/800.jpg",
        "https://picsum.photos/seed/wedding275/1000/800.jpg",
        "https://picsum.photos/seed/wedding276/1000/800.jpg",
        "https://picsum.photos/seed/wedding277/1000/800.jpg",
        "https://picsum.photos/seed/wedding278/1000/800.jpg",
        "https://picsum.photos/seed/wedding279/1000/800.jpg",
        "https://picsum.photos/seed/wedding280/1000/800.jpg",
        "https://picsum.photos/seed/wedding281/1000/800.jpg",
        "https://picsum.photos/seed/wedding282/1000/800.jpg",
        "https://picsum.photos/seed/wedding283/1000/800.jpg",
        "https://picsum.photos/seed/wedding284/1000/800.jpg",
        "https://picsum.photos/seed/wedding285/1000/800.jpg",
        "https://picsum.photos/seed/wedding286/1000/800.jpg",
        "https://picsum.photos/seed/wedding287/1000/800.jpg",
        "https://picsum.photos/seed/wedding288/1000/800.jpg",
        "https://picsum.photos/seed/wedding289/1000/800.jpg",
        "https://picsum.photos/seed/wedding290/1000/800.jpg",
        "https://picsum.photos/seed/wedding291/1000/800.jpg",
        "https://picsum.photos/seed/wedding292/1000/800.jpg",
        "https://picsum.photos/seed/wedding293/1000/800.jpg",
        "https://picsum.photos/seed/wedding294/1000/800.jpg",
        "https://picsum.photos/seed/wedding295/1000/800.jpg",
        "https://picsum.photos/seed/wedding296/1000/800.jpg",
        "https://picsum.photos/seed/wedding297/1000/800.jpg",
        "https://picsum.photos/seed/wedding298/1000/800.jpg",
        "https://picsum.photos/seed/wedding299/1000/800.jpg",
        "https://picsum.photos/seed/wedding300/1000/800.jpg"
      ]
    }
  }')

# Extract status code (last line) and body (everything before)
http_code=$(echo "$response" | tail -n1)
body=$(echo "$response" | sed '$d')

if [ "$http_code" = "201" ]; then
  echo "‚úÖ Project created successfully!"
  echo "$body" | jq -r '"Project ID: \(.result.projectId)\nRedirect your customer to: \(.result.redirectUrl)"'
else
  echo "‚ùå Error creating project (HTTP $http_code):"
  echo "$body" | jq .
fi
